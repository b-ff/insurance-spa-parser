!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,u=i.length;s<u;s++,o++)r[o]=i[s];return r},r=["Отчёт МО в МГФОМС","Отчёт МО в СМО"],o=/^filter-panel-\d{4,}_header-title-textEl$/,i=/^messageTypeCombo-\d{4,}-picker-listEl$/,s=/^messageTypeCombo-\d{4,}-trigger-picker$/,u=/^commonInsurersCombo-\d{4,}-picker-listEl$/,l=/^commonInsurersCombo-\d{4,}-trigger-picker$/,a=/^filter-panel-\d{4,}$/,c=/^parcelsList-\d{4,}-body$/,f=function(t,e,n){void 0===n&&(n="div");var r=t.querySelectorAll(n);return Array.from(r).find((function(t){return e.test(t.id)}))},g=function(){function t(){var t=this;this.timeoutIDs=[],this.isRunning=!1;var e=setInterval((function(){var n=f(document,o);if(n){t.addStartButton(n);var r=f(document,l),i=f(document,s);i.click(),setTimeout((function(){i.click(),r.click(),setTimeout((function(){r.click()}),500)}),500),clearInterval(e)}}),500);this.log("Parser initialized!")}return t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console&&console.log&&console.log.apply(console,n(["Parser: "],t))},t.prototype.addStartButton=function(t){var e=this,n=document.createElement("button");n.innerHTML="Запустить сбор данных",n.id="parser-start-button",n.style.marginLeft="10px",n.style.cursor="pointer",n.onclick=function(){e.isRunning?e.stopParser():e.startParser(),n.innerHTML=e.isRunning?"Остановить сбор данных":"Запустить сбор данных"},t.append(n),this.log("Added start button to container:",t)},t.prototype.startParser=function(){var t=this;this.log("Parser started!"),this.isRunning=!0,this.timeoutIDs=[];var e=this.getMessageTypes(),n=this.getInsurers();this.log("Loaded filter values:",{messageTypes:e,insurers:n}),this.log("Running a queue");var r=0;e.forEach((function(o,i){n.forEach((function(s,u){var l=setTimeout((function(){t.log("Applying filter values:",{messageType:o,insurer:s}),t.setMessageType(o),t.setInsurer(s),t.getFilterSubmitButton().click();var r=setTimeout((function(){t.log("Getting files list");var r=t.getFilesList();r.length?(t.log("Found "+r.length+" files"),t.downloadFile(t.getFilesList().pop())):t.log("No files for selected filters");var o=i===e.length-1,s=u===n.length-1;o&&s&&alert("Загрузка файлов завершена!")}),5e3);t.timeoutIDs.push(r)}),7e3*r);t.timeoutIDs.push(l),r++}))}))},t.prototype.stopParser=function(){this.timeoutIDs.forEach((function(t){clearTimeout(t)})),this.isRunning=!1},t.prototype.getMessageTypeSuggestions=function(){return Array.from(f(document,i,"ul").childNodes)},t.prototype.getMessageTypes=function(){return this.getMessageTypeSuggestions().map((function(t){return t.textContent})).filter((function(t){return r.includes(t)}))},t.prototype.setMessageType=function(t){this.getMessageTypeSuggestions().find((function(e){return e.textContent===t})).click(),this.log("Set message type filter to:",t)},t.prototype.getInsurersSuggestions=function(){return Array.from(f(document,u,"ul").childNodes)},t.prototype.getInsurers=function(){return this.getInsurersSuggestions().map((function(t){return t.textContent}))},t.prototype.setInsurer=function(t){this.getInsurersSuggestions().find((function(e){return e.textContent===t})).click(),this.log("Set insurer filter to:",t)},t.prototype.getFilterSubmitButton=function(){var t=f(document,a).querySelectorAll("a.x-btn");return t.length?t[0]:null},t.prototype.getDateFromElement=function(t){if(t){if(t.textContent)return e=t.textContent,n="dd.mm.yyyy hh:ii",r=e.replace(/[^a-zA-Z0-9]/g,"-"),o=n.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").split("-"),i=r.split("-"),s=o.indexOf("mm"),u=o.indexOf("dd"),l=o.indexOf("yyyy"),a=o.indexOf("hh"),c=o.indexOf("ii"),f=o.indexOf("ss"),g=new Date,p=l>-1?+i[l]:g.getFullYear(),d=s>-1?+i[s]:g.getMonth(),y=u>-1?+i[u]:g.getDate(),m=a>-1?+i[a]:g.getHours(),h=c>-1?+i[c]:g.getMinutes(),v=f>-1?+i[f]:g.getSeconds(),new Date(p,d,y,m,h,v);this.log("Empty Date Cell Text!",t)}else this.log("Date node not found!",t);var e,n,r,o,i,s,u,l,a,c,f,g,p,d,y,m,h,v;return null},t.prototype.getFilesList=function(){var t=this;return Array.from(f(document,c).querySelectorAll("table")).map((function(e){var n=e.querySelectorAll("td"),r=n[5],o=n[9],i=r?r.querySelector("a"):null;return{url:i?i.href:null,sendDate:o?t.getDateFromElement(o.firstChild):new Date}})).filter((function(t){return!!t.url})).sort((function(t,e){return t.sendDate.getTime()-e.sendDate.getTime()}))},t.prototype.downloadFile=function(t){this.log("file download >>",t),t.url&&window.open(t.url,"_blank")},t}();!function(t){t.parser=new g,t.getElementByIdPattern=f}(window)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhcnNlci50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkFMTE9XRURfTUVTU0FHRV9UWVBFUyIsIlNUQVJUX0JVVFRPTl9DT05UQUlORVJfSURfUEFUVEVSTiIsIk1FU1NBR0VfVFlQRVNfTElTVF9JRF9QQVRURVJOIiwiTUVTU0FHRV9UWVBFX0xJU1RfVE9HR0xFX0lEX1BBVFRFUk4iLCJJTlNVUkVSU19MSVNUX0lEX1BBVFRFUk4iLCJJTlNVUkVSU19MSVNUX1RPR0dMRV9JRF9QQVRURVJOIiwiRklMVEVSU19QQU5FTF9JRF9QQVRURVJOIiwiUEFSQ0VMU19MSVNUX0lEX1BBVFRFUk4iLCJnZXRFbGVtZW50QnlJZFBhdHRlcm4iLCJwYXJlbnQiLCJpZFBhdHRlcm4iLCJ0YWdOYW1lIiwiZWxlbWVudHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiQXJyYXkiLCJmcm9tIiwiZmluZCIsImVsZW1lbnQiLCJ0ZXN0IiwiaWQiLCJ0aW1lb3V0SURzIiwiaXNSdW5uaW5nIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiYnV0dG9uQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJhZGRTdGFydEJ1dHRvbiIsImNsaWNrIiwic2V0VGltZW91dCIsImNsZWFySW50ZXJ2YWwiLCJ0aGlzIiwibG9nIiwiY29uc29sZSIsImFyZ3MiLCJjb250YWluZXIiLCJidXR0b24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwic3R5bGUiLCJtYXJnaW5MZWZ0IiwiY3Vyc29yIiwib25jbGljayIsInN0b3BQYXJzZXIiLCJzdGFydFBhcnNlciIsImFwcGVuZCIsIm1lc3NhZ2VUeXBlcyIsImdldE1lc3NhZ2VUeXBlcyIsImluc3VyZXJzIiwiZ2V0SW5zdXJlcnMiLCJpbmNyZW1lbnQiLCJmb3JFYWNoIiwibWVzc2FnZVR5cGUiLCJtZXNzYWdlVHlwZUluZGV4IiwiaW5zdXJlciIsImluc3VyZXJJbmRleCIsInRpbWVvdXRBIiwic2V0TWVzc2FnZVR5cGUiLCJzZXRJbnN1cmVyIiwiZ2V0RmlsdGVyU3VibWl0QnV0dG9uIiwidGltZW91dEIiLCJmaWxlc0xpc3QiLCJnZXRGaWxlc0xpc3QiLCJsZW5ndGgiLCJkb3dubG9hZEZpbGUiLCJwb3AiLCJpc0xhc3RNZXNzYWdlVHlwZSIsImlzTGFzdEluc3VyZXIiLCJhbGVydCIsInB1c2giLCJ0aW1lb3V0SUQiLCJjbGVhclRpbWVvdXQiLCJnZXRNZXNzYWdlVHlwZVN1Z2dlc3Rpb25zIiwiY2hpbGROb2RlcyIsIm1hcCIsInRleHRDb250ZW50IiwiZmlsdGVyIiwiaW5jbHVkZXMiLCJnZXRJbnN1cmVyc1N1Z2dlc3Rpb25zIiwiYnV0dG9ucyIsImdldERhdGVGcm9tRWxlbWVudCIsIm5vZGUiLCJ0ZXh0IiwiZm9ybWF0Iiwibm9ybWFsaXplZCIsInJlcGxhY2UiLCJmb3JtYXRJdGVtcyIsInRvTG93ZXJDYXNlIiwic3BsaXQiLCJkYXRlSXRlbXMiLCJtb250aEluZGV4IiwiaW5kZXhPZiIsImRheUluZGV4IiwieWVhckluZGV4IiwiaG91ckluZGV4IiwibWludXRlc0luZGV4Iiwic2Vjb25kc0luZGV4IiwidG9kYXkiLCJEYXRlIiwieWVhciIsImdldEZ1bGxZZWFyIiwibW9udGgiLCJnZXRNb250aCIsImRheSIsImdldERhdGUiLCJob3VyIiwiZ2V0SG91cnMiLCJtaW51dGUiLCJnZXRNaW51dGVzIiwic2Vjb25kIiwiZ2V0U2Vjb25kcyIsInRhYmxlRWxlbWVudCIsImNlbGxzIiwidXJsQ2VsbCIsImRhdGVDZWxsIiwibGluayIsInF1ZXJ5U2VsZWN0b3IiLCJ1cmwiLCJocmVmIiwic2VuZERhdGUiLCJmaXJzdENoaWxkIiwiZmlsZSIsInNvcnQiLCJhIiwiYiIsImdldFRpbWUiLCJ3aW5kb3ciLCJvcGVuIiwicGFyc2VyIiwiUGFyc2VyIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFB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Y2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImNvbnN0IFJFUE9SVF9JTl9NR0ZPTVMgPSAn0J7RgtGH0ZHRgiDQnNCeINCyINCc0JPQpNCe0JzQoSdcbmNvbnN0IFJFUE9SVF9JTl9TTU8gPSAn0J7RgtGH0ZHRgiDQnNCeINCyINCh0JzQnidcblxuY29uc3QgQUxMT1dFRF9NRVNTQUdFX1RZUEVTID0gW1JFUE9SVF9JTl9NR0ZPTVMsIFJFUE9SVF9JTl9TTU9dXG5cbmNvbnN0IFNUQVJUX0JVVFRPTl9JRCA9ICdwYXJzZXItc3RhcnQtYnV0dG9uJ1xuXG5jb25zdCBEQVRFX0ZPUk1BVCA9ICdkZC5tbS55eXl5IGhoOmlpJ1xuXG5jb25zdCBTVEFSVF9CVVRUT05fQ09OVEFJTkVSX0lEX1BBVFRFUk4gPSAvXmZpbHRlci1wYW5lbC1cXGR7NCx9X2hlYWRlci10aXRsZS10ZXh0RWwkL1xuY29uc3QgTUVTU0FHRV9UWVBFX0ZJRUxEX0lEX1BBVFRFUk4gPSAvXm1lc3NhZ2VUeXBlQ29tYm8tXFxkezQsfS1pbnB1dEVsJC9cbmNvbnN0IE1FU1NBR0VfVFlQRVNfTElTVF9JRF9QQVRURVJOID0gL15tZXNzYWdlVHlwZUNvbWJvLVxcZHs0LH0tcGlja2VyLWxpc3RFbCQvXG5jb25zdCBNRVNTQUdFX1RZUEVfTElTVF9UT0dHTEVfSURfUEFUVEVSTiA9IC9ebWVzc2FnZVR5cGVDb21iby1cXGR7NCx9LXRyaWdnZXItcGlja2VyJC9cbmNvbnN0IElOU1VSRVJfRklFTERfSURfUEFUVEVSTiA9IC9eY29tbW9uSW5zdXJlcnNDb21iby1cXGR7NCx9LWlucHV0RWwkL1xuY29uc3QgSU5TVVJFUlNfTElTVF9JRF9QQVRURVJOID0gL15jb21tb25JbnN1cmVyc0NvbWJvLVxcZHs0LH0tcGlja2VyLWxpc3RFbCQvXG5jb25zdCBJTlNVUkVSU19MSVNUX1RPR0dMRV9JRF9QQVRURVJOID0gL15jb21tb25JbnN1cmVyc0NvbWJvLVxcZHs0LH0tdHJpZ2dlci1waWNrZXIkL1xuY29uc3QgRklMVEVSU19QQU5FTF9JRF9QQVRURVJOID0gL15maWx0ZXItcGFuZWwtXFxkezQsfSQvXG5jb25zdCBQQVJDRUxTX0xJU1RfSURfUEFUVEVSTiA9IC9ecGFyY2Vsc0xpc3QtXFxkezQsfS1ib2R5JC9cblxuY29uc3QgRklMRV9MSU5LX0NFTExfSU5ERVggPSA1XG5jb25zdCBGSUxFX1NFTkRfREFURV9DRUxMX0lOREVYID0gOVxuXG5jb25zdCBGSUxURVJTX0NIQU5HRV9JTlRFUlZBTCA9IDIwMDBcbmNvbnN0IFBBUkNFTFNfTE9BRF9USU1FID0gNTAwMFxuXG5pbnRlcmZhY2UgSUZpbGVEYXRhIHtcbiAgc2VuZERhdGU6IERhdGUsXG4gIHVybDogc3RyaW5nXG59XG5cbmNvbnN0IGdldEVsZW1lbnRCeUlkUGF0dGVybiA9IChwYXJlbnQ6IEhUTUxFbGVtZW50IHwgRG9jdW1lbnQsIGlkUGF0dGVybjogUmVnRXhwLCB0YWdOYW1lOiBzdHJpbmcgPSAnZGl2Jyk6IEVsZW1lbnQgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKHRhZ05hbWUpXG4gIHJldHVybiBBcnJheS5mcm9tKGVsZW1lbnRzKS5maW5kKChlbGVtZW50OiBFbGVtZW50KTogYm9vbGVhbiA9PiBpZFBhdHRlcm4udGVzdChlbGVtZW50LmlkKSlcbn1cblxuY29uc3Qgc3RyaW5nVG9EYXRlQnlGb3JtYXQgPSAodGV4dDogc3RyaW5nLCBmb3JtYXQ6IHN0cmluZyk6IERhdGUgPT4ge1xuICBjb25zdCBub3JtYWxpemVkICAgICAgPSB0ZXh0LnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCAnLScpXG4gIGNvbnN0IG5vcm1hbGl6ZWRGb3JtYXQgPSBmb3JtYXQudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtekEtWjAtOV0vZywgJy0nKVxuICBjb25zdCBmb3JtYXRJdGVtcyAgICAgPSBub3JtYWxpemVkRm9ybWF0LnNwbGl0KCctJylcbiAgY29uc3QgZGF0ZUl0ZW1zICAgICAgID0gbm9ybWFsaXplZC5zcGxpdCgnLScpXG5cbiAgY29uc3QgbW9udGhJbmRleCAgPSBmb3JtYXRJdGVtcy5pbmRleE9mKCdtbScpXG4gIGNvbnN0IGRheUluZGV4ICAgID0gZm9ybWF0SXRlbXMuaW5kZXhPZignZGQnKVxuICBjb25zdCB5ZWFySW5kZXggICA9IGZvcm1hdEl0ZW1zLmluZGV4T2YoJ3l5eXknKVxuICBjb25zdCBob3VySW5kZXggICAgID0gZm9ybWF0SXRlbXMuaW5kZXhPZignaGgnKVxuICBjb25zdCBtaW51dGVzSW5kZXggID0gZm9ybWF0SXRlbXMuaW5kZXhPZignaWknKVxuICBjb25zdCBzZWNvbmRzSW5kZXggID0gZm9ybWF0SXRlbXMuaW5kZXhPZignc3MnKVxuXG4gIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuXG4gIGNvbnN0IHllYXIgPSB5ZWFySW5kZXggPiAtMSA/ICtkYXRlSXRlbXNbeWVhckluZGV4XSA6IHRvZGF5LmdldEZ1bGxZZWFyKClcbiAgY29uc3QgbW9udGggPSBtb250aEluZGV4ID4gLTEgPyArZGF0ZUl0ZW1zW21vbnRoSW5kZXhdIDogdG9kYXkuZ2V0TW9udGgoKVxuICBjb25zdCBkYXkgPSBkYXlJbmRleCA+IC0xID8gK2RhdGVJdGVtc1tkYXlJbmRleF0gOiB0b2RheS5nZXREYXRlKClcblxuICBjb25zdCBob3VyID0gaG91ckluZGV4ID4gLTEgPyArZGF0ZUl0ZW1zW2hvdXJJbmRleF0gOiB0b2RheS5nZXRIb3VycygpXG4gIGNvbnN0IG1pbnV0ZSA9IG1pbnV0ZXNJbmRleCA+IC0xID8gK2RhdGVJdGVtc1ttaW51dGVzSW5kZXhdIDogdG9kYXkuZ2V0TWludXRlcygpXG4gIGNvbnN0IHNlY29uZCA9IHNlY29uZHNJbmRleCA+IC0xID8gK2RhdGVJdGVtc1tzZWNvbmRzSW5kZXhdIDogdG9kYXkuZ2V0U2Vjb25kcygpXG5cbiAgcmV0dXJuIG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXksIGhvdXIsIG1pbnV0ZSwgc2Vjb25kKVxufVxuXG5jbGFzcyBQYXJzZXIge1xuICBwcml2YXRlIHRpbWVvdXRJRHM6IGFueVtdID0gW11cbiAgcHJpdmF0ZSBpc1J1bm5pbmc6IGJvb2xlYW4gPSBmYWxzZVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIFNUQVJUX0JVVFRPTl9DT05UQUlORVJfSURfUEFUVEVSTilcblxuICAgICAgaWYgKGJ1dHRvbkNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLmFkZFN0YXJ0QnV0dG9uKGJ1dHRvbkNvbnRhaW5lcilcblxuICAgICAgICBjb25zdCBpbnN1cmVyc0xpc3RUb2dnbGUgPSBnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIElOU1VSRVJTX0xJU1RfVE9HR0xFX0lEX1BBVFRFUk4pIGFzIEhUTUxFbGVtZW50XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VUeXBlTGlzdFRvZ2dsZSA9IGdldEVsZW1lbnRCeUlkUGF0dGVybihkb2N1bWVudCwgTUVTU0FHRV9UWVBFX0xJU1RfVE9HR0xFX0lEX1BBVFRFUk4pIGFzIEhUTUxFbGVtZW50XG5cbiAgICAgICAgbWVzc2FnZVR5cGVMaXN0VG9nZ2xlLmNsaWNrKClcblxuICAgICAgICBzZXRUaW1lb3V0KCgpOiB2b2lkID0+IHtcbiAgICAgICAgICBtZXNzYWdlVHlwZUxpc3RUb2dnbGUuY2xpY2soKVxuICAgICAgICAgIGluc3VyZXJzTGlzdFRvZ2dsZS5jbGljaygpXG4gICAgICAgICAgc2V0VGltZW91dCgoKTogdm9pZCA9PiB7IGluc3VyZXJzTGlzdFRvZ2dsZS5jbGljaygpIH0sIDUwMClcbiAgICAgICAgfSwgNTAwKVxuXG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZClcbiAgICAgIH1cbiAgICB9LCA1MDApXG5cblxuICAgIHRoaXMubG9nKCdQYXJzZXIgaW5pdGlhbGl6ZWQhJylcbiAgfVxuXG4gIHByaXZhdGUgbG9nKC4uLmFyZ3M6IGFueSk6IHZvaWQge1xuICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGUubG9nKSB7XG4gICAgICBjb25zb2xlLmxvZygnUGFyc2VyOiAnLCAuLi5hcmdzKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkU3RhcnRCdXR0b24oY29udGFpbmVyOiBFbGVtZW50KTogdm9pZCB7XG4gICAgY29uc3Qgc3RhcnRUZXh0ID0gJ9CX0LDQv9GD0YHRgtC40YLRjCDRgdCx0L7RgCDQtNCw0L3QvdGL0YUnXG4gICAgY29uc3Qgc3RvcFRleHQgPSAn0J7RgdGC0LDQvdC+0LLQuNGC0Ywg0YHQsdC+0YAg0LTQsNC90L3Ri9GFJ1xuICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG5cbiAgICBidXR0b24uaW5uZXJIVE1MID0gc3RhcnRUZXh0XG4gICAgYnV0dG9uLmlkID0gU1RBUlRfQlVUVE9OX0lEXG4gICAgYnV0dG9uLnN0eWxlLm1hcmdpbkxlZnQgPSAnMTBweCdcbiAgICBidXR0b24uc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInXG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICBpZiAodGhpcy5pc1J1bm5pbmcpIHtcbiAgICAgICAgdGhpcy5zdG9wUGFyc2VyKClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3RhcnRQYXJzZXIoKVxuICAgICAgfVxuXG4gICAgICBidXR0b24uaW5uZXJIVE1MID0gdGhpcy5pc1J1bm5pbmcgPyBzdG9wVGV4dCA6IHN0YXJ0VGV4dFxuICAgIH1cblxuICAgIGNvbnRhaW5lci5hcHBlbmQoYnV0dG9uKVxuXG4gICAgdGhpcy5sb2coJ0FkZGVkIHN0YXJ0IGJ1dHRvbiB0byBjb250YWluZXI6JywgY29udGFpbmVyKVxuICB9XG5cbiAgcHVibGljIHN0YXJ0UGFyc2VyKCk6IHZvaWQge1xuICAgIHRoaXMubG9nKCdQYXJzZXIgc3RhcnRlZCEnKVxuICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZVxuICAgIHRoaXMudGltZW91dElEcyA9IFtdXG5cbiAgICBjb25zdCBtZXNzYWdlVHlwZXMgPSB0aGlzLmdldE1lc3NhZ2VUeXBlcygpXG4gICAgY29uc3QgaW5zdXJlcnMgPSB0aGlzLmdldEluc3VyZXJzKClcblxuICAgIHRoaXMubG9nKCdMb2FkZWQgZmlsdGVyIHZhbHVlczonLCB7IG1lc3NhZ2VUeXBlcywgaW5zdXJlcnMgfSlcbiAgICB0aGlzLmxvZygnUnVubmluZyBhIHF1ZXVlJylcblxuICAgIGxldCBpbmNyZW1lbnQgPSAwXG5cbiAgICBtZXNzYWdlVHlwZXMuZm9yRWFjaCgobWVzc2FnZVR5cGU6IHN0cmluZywgbWVzc2FnZVR5cGVJbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICBpbnN1cmVycy5mb3JFYWNoKChpbnN1cmVyOiBzdHJpbmcsIGluc3VyZXJJbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRBID0gc2V0VGltZW91dCgoKTogdm9pZCA9PiB7XG4gICAgICAgICAgdGhpcy5sb2coJ0FwcGx5aW5nIGZpbHRlciB2YWx1ZXM6Jywge21lc3NhZ2VUeXBlLCBpbnN1cmVyfSlcbiAgICAgICAgICB0aGlzLnNldE1lc3NhZ2VUeXBlKG1lc3NhZ2VUeXBlKVxuICAgICAgICAgIHRoaXMuc2V0SW5zdXJlcihpbnN1cmVyKVxuICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyU3VibWl0QnV0dG9uKCkuY2xpY2soKVxuXG4gICAgICAgICAgY29uc3QgdGltZW91dEIgPSBzZXRUaW1lb3V0KCgpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nKCdHZXR0aW5nIGZpbGVzIGxpc3QnKVxuXG4gICAgICAgICAgICBjb25zdCBmaWxlc0xpc3QgPSB0aGlzLmdldEZpbGVzTGlzdCgpXG5cbiAgICAgICAgICAgIGlmIChmaWxlc0xpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHRoaXMubG9nKGBGb3VuZCAke2ZpbGVzTGlzdC5sZW5ndGh9IGZpbGVzYClcbiAgICAgICAgICAgICAgdGhpcy5kb3dubG9hZEZpbGUodGhpcy5nZXRGaWxlc0xpc3QoKS5wb3AoKSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMubG9nKGBObyBmaWxlcyBmb3Igc2VsZWN0ZWQgZmlsdGVyc2ApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGlzTGFzdE1lc3NhZ2VUeXBlID0gbWVzc2FnZVR5cGVJbmRleCA9PT0gbWVzc2FnZVR5cGVzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgIGNvbnN0IGlzTGFzdEluc3VyZXIgPSBpbnN1cmVySW5kZXggPT09IGluc3VyZXJzLmxlbmd0aCAtIDFcblxuICAgICAgICAgICAgaWYgKGlzTGFzdE1lc3NhZ2VUeXBlICYmIGlzTGFzdEluc3VyZXIpIHtcbiAgICAgICAgICAgICAgYWxlcnQoJ9CX0LDQs9GA0YPQt9C60LAg0YTQsNC50LvQvtCyINC30LDQstC10YDRiNC10L3QsCEnKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIFBBUkNFTFNfTE9BRF9USU1FKVxuXG4gICAgICAgICAgdGhpcy50aW1lb3V0SURzLnB1c2godGltZW91dEIpXG4gICAgICAgIH0sIGluY3JlbWVudCAqIChQQVJDRUxTX0xPQURfVElNRSArIEZJTFRFUlNfQ0hBTkdFX0lOVEVSVkFMKSlcbiAgICAgICAgdGhpcy50aW1lb3V0SURzLnB1c2godGltZW91dEEpXG5cbiAgICAgICAgaW5jcmVtZW50KytcbiAgICAgIH0pXG4gICAgfSlcblxuICB9XG5cbiAgcHVibGljIHN0b3BQYXJzZXIoKTogdm9pZCB7XG4gICAgdGhpcy50aW1lb3V0SURzLmZvckVhY2goKHRpbWVvdXRJRDogbnVtYmVyKTogdm9pZCA9PiB7IGNsZWFyVGltZW91dCh0aW1lb3V0SUQpIH0pXG4gICAgdGhpcy5pc1J1bm5pbmcgPSBmYWxzZVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRNZXNzYWdlVHlwZVN1Z2dlc3Rpb25zKCk6IENoaWxkTm9kZVtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIE1FU1NBR0VfVFlQRVNfTElTVF9JRF9QQVRURVJOLCAndWwnKS5jaGlsZE5vZGVzKVxuICB9XG5cbiAgcHVibGljIGdldE1lc3NhZ2VUeXBlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TWVzc2FnZVR5cGVTdWdnZXN0aW9ucygpXG4gICAgICAubWFwKChlbGVtZW50OiBFbGVtZW50KTogc3RyaW5nID0+IGVsZW1lbnQudGV4dENvbnRlbnQpXG4gICAgICAuZmlsdGVyKChtZXNzYWdlVHlwZTogc3RyaW5nKTogYm9vbGVhbiA9PiBBTExPV0VEX01FU1NBR0VfVFlQRVMuaW5jbHVkZXMobWVzc2FnZVR5cGUpKVxuICB9XG5cbiAgcHVibGljIHNldE1lc3NhZ2VUeXBlKG1lc3NhZ2VUeXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBzdWdnZXN0aW9ucyA9IHRoaXMuZ2V0TWVzc2FnZVR5cGVTdWdnZXN0aW9ucygpXG4gICAgY29uc3QgbWF0Y2hpbmdTdWdnZXN0aW9uID0gc3VnZ2VzdGlvbnMuZmluZCgoZWxlbWVudDogRWxlbWVudCk6IGJvb2xlYW4gPT4gZWxlbWVudC50ZXh0Q29udGVudCA9PT0gbWVzc2FnZVR5cGUpIGFzIEhUTUxFbGVtZW50XG5cbiAgICBtYXRjaGluZ1N1Z2dlc3Rpb24uY2xpY2soKVxuICAgIHRoaXMubG9nKCdTZXQgbWVzc2FnZSB0eXBlIGZpbHRlciB0bzonLCBtZXNzYWdlVHlwZSlcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SW5zdXJlcnNTdWdnZXN0aW9ucygpOiBDaGlsZE5vZGVbXSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oZ2V0RWxlbWVudEJ5SWRQYXR0ZXJuKGRvY3VtZW50LCBJTlNVUkVSU19MSVNUX0lEX1BBVFRFUk4sICd1bCcpLmNoaWxkTm9kZXMpXG4gIH1cblxuICBwdWJsaWMgZ2V0SW5zdXJlcnMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLmdldEluc3VyZXJzU3VnZ2VzdGlvbnMoKVxuICAgICAgLm1hcCgoZWxlbWVudDogRWxlbWVudCk6IHN0cmluZyA9PiBlbGVtZW50LnRleHRDb250ZW50KVxuICB9XG5cbiAgcHVibGljIHNldEluc3VyZXIoaW5zdXJlcjogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSB0aGlzLmdldEluc3VyZXJzU3VnZ2VzdGlvbnMoKVxuICAgIGNvbnN0IG1hdGNoaW5nU3VnZ2VzdGlvbiA9IHN1Z2dlc3Rpb25zLmZpbmQoKGVsZW1lbnQ6IEVsZW1lbnQpOiBib29sZWFuID0+IGVsZW1lbnQudGV4dENvbnRlbnQgPT09IGluc3VyZXIpIGFzIEhUTUxFbGVtZW50XG5cbiAgICBtYXRjaGluZ1N1Z2dlc3Rpb24uY2xpY2soKVxuICAgIHRoaXMubG9nKCdTZXQgaW5zdXJlciBmaWx0ZXIgdG86JywgaW5zdXJlcilcbiAgfVxuXG4gIHB1YmxpYyBnZXRGaWx0ZXJTdWJtaXRCdXR0b24oKTogSFRNTEVsZW1lbnQgfCBudWxsIHtcbiAgICBjb25zdCBmaWx0ZXJzUGFuZWwgPSBnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIEZJTFRFUlNfUEFORUxfSURfUEFUVEVSTikgYXMgSFRNTEVsZW1lbnRcbiAgICBjb25zdCBidXR0b25zID0gZmlsdGVyc1BhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EueC1idG4nKVxuXG4gICAgaWYgKGJ1dHRvbnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gYnV0dG9uc1swXSBhcyBIVE1MRWxlbWVudFxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF0ZUZyb21FbGVtZW50KG5vZGU6IE5vZGUpOiBEYXRlIHtcbiAgICBpZiAobm9kZSkge1xuICAgICAgaWYgKG5vZGUudGV4dENvbnRlbnQpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ1RvRGF0ZUJ5Rm9ybWF0KG5vZGUudGV4dENvbnRlbnQsIERBVEVfRk9STUFUKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2coJ0VtcHR5IERhdGUgQ2VsbCBUZXh0IScsIG5vZGUpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9nKCdEYXRlIG5vZGUgbm90IGZvdW5kIScsIG5vZGUpXG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIHB1YmxpYyBnZXRGaWxlc0xpc3QoKTogYW55W10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGdldEVsZW1lbnRCeUlkUGF0dGVybihkb2N1bWVudCwgUEFSQ0VMU19MSVNUX0lEX1BBVFRFUk4pLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RhYmxlJykpXG4gICAgICAubWFwKCh0YWJsZUVsZW1lbnQ6IEhUTUxFbGVtZW50KTogSUZpbGVEYXRhID0+IHtcbiAgICAgICAgY29uc3QgY2VsbHMgPSB0YWJsZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICBjb25zdCB1cmxDZWxsID0gY2VsbHNbRklMRV9MSU5LX0NFTExfSU5ERVhdXG4gICAgICAgIGNvbnN0IGRhdGVDZWxsID0gY2VsbHNbRklMRV9TRU5EX0RBVEVfQ0VMTF9JTkRFWF1cbiAgICAgICAgY29uc3QgbGluayA9IHVybENlbGwgPyB1cmxDZWxsLnF1ZXJ5U2VsZWN0b3IoJ2EnKSA6IG51bGxcblxuICAgICAgICBjb25zdCB1cmwgPSBsaW5rID8gbGluay5ocmVmIDogbnVsbFxuICAgICAgICBjb25zdCBzZW5kRGF0ZSA9IGRhdGVDZWxsID8gdGhpcy5nZXREYXRlRnJvbUVsZW1lbnQoZGF0ZUNlbGwuZmlyc3RDaGlsZCkgOiBuZXcgRGF0ZSgpXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgc2VuZERhdGVcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5maWx0ZXIoKGZpbGU6IElGaWxlRGF0YSk6IGJvb2xlYW4gPT4gISFmaWxlLnVybClcbiAgICAgIC5zb3J0KChhOiBJRmlsZURhdGEsIGI6IElGaWxlRGF0YSk6IG51bWJlciA9PiBhLnNlbmREYXRlLmdldFRpbWUoKSAtIGIuc2VuZERhdGUuZ2V0VGltZSgpKVxuICB9XG5cbiAgcHJpdmF0ZSBkb3dubG9hZEZpbGUoZmlsZTogSUZpbGVEYXRhKTogdm9pZCB7XG4gICAgdGhpcy5sb2coJ2ZpbGUgZG93bmxvYWQgPj4nLCBmaWxlKVxuICAgIGlmIChmaWxlLnVybCkge1xuICAgICAgd2luZG93Lm9wZW4oZmlsZS51cmwsICdfYmxhbmsnKVxuICAgIH1cbiAgfVxufVxuXG4oKHdpbmRvdzogYW55KTogdm9pZCA9PiB7XG4gIHdpbmRvdy5wYXJzZXIgPSBuZXcgUGFyc2VyKClcbiAgd2luZG93LmdldEVsZW1lbnRCeUlkUGF0dGVybiA9IGdldEVsZW1lbnRCeUlkUGF0dGVyblxufSkod2luZG93KVxuIl0sInNvdXJjZVJvb3QiOiIifQ==