!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],l=0,u=i.length;l<u;l++,o++)r[o]=i[l];return r},r=/^filter-panel-\d{4,}_header-title-textEl$/,o=/^messageTypeCombo-\d{4,}-inputEl$/,i=/^commonInsurersCombo-\d{4,}-picker-listEl$/,l=/^commonInsurersCombo-\d{4,}-trigger-picker$/,u=/^filter-panel-\d{4,}$/,s=/^parcelsList-\d{4,}-body$/,a=function(e,t,n){void 0===n&&(n="div");var r=e.querySelectorAll(n);return Array.from(r).find((function(e){return t.test(e.id)}))},c=function(){function e(){var e=this,t=setInterval((function(){var n=a(document,r);if(n){e.addStartButton(n);var o=a(document,l);o.click(),setTimeout((function(){o.click()}),500),clearInterval(t)}}),500);this.log("Parser initialized!")}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console&&console.log&&console.log.apply(console,n(["Parser: "],e))},e.prototype.addStartButton=function(e){var t=this,n=document.createElement("button");n.innerHTML="Запустить сбор данных",n.id="parser-start-button",n.style.marginLeft="10px",n.style.cursor="pointer",n.onclick=function(){t.startParser()},e.append(n),this.log("Added start button to container:",e)},e.prototype.startParser=function(){var e=this;this.log("Parser started!");var t=this.getMessageTypes(),n=this.getInsurers();this.log("Loaded filter values:",{messageTypes:t,insurers:n}),this.log("Running a queue");var r=0;t.forEach((function(o,i){n.forEach((function(l,u){setTimeout((function(){e.log("Applying filter values:",{messageType:o,insurer:l}),e.setMessageType(o),e.setInsurer(l),e.getFilterSubmitButton().click(),setTimeout((function(){e.log("Getting files list");var r=e.getFilesList();r.length?(e.log("Found "+r.length+" files"),e.downloadFile(e.getFilesList().pop())):e.log("No files for selected filters");var o=i===t.length-1,l=u===n.length-1;o&&l&&alert("Загрузка файлов завершена!")}),5e3)}),7e3*r),r++}))}))},e.prototype.getMessageTypes=function(){return["Отчёт МО в МГФОМС","Отчёт МО в СМО"]},e.prototype.setMessageType=function(e){a(document,o,"input").value=e,this.log("Set message type filter to:",e)},e.prototype.getInsurersSuggestions=function(){return Array.from(a(document,i,"ul").childNodes)},e.prototype.getInsurers=function(){return this.getInsurersSuggestions().map((function(e){return e.textContent}))},e.prototype.setInsurer=function(e){this.getInsurersSuggestions().find((function(t){return t.textContent===e})).click(),this.log("Set insurer filter to:",e)},e.prototype.getFilterSubmitButton=function(){var e=a(document,u).querySelectorAll("a.x-btn");return e.length?e[0]:null},e.prototype.getDateFromElement=function(e){if(e){if(e.textContent)return t=e.textContent,n="dd.mm.yyyy hh:ii",r=t.replace(/[^a-zA-Z0-9]/g,"-"),o=n.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").split("-"),i=r.split("-"),l=o.indexOf("mm"),u=o.indexOf("dd"),s=o.indexOf("yyyy"),a=o.indexOf("hh"),c=o.indexOf("ii"),f=o.indexOf("ss"),d=new Date,g=s>-1?+i[s]:d.getFullYear(),p=l>-1?+i[l]:d.getMonth(),y=u>-1?+i[u]:d.getDate(),m=a>-1?+i[a]:d.getHours(),h=c>-1?+i[c]:d.getMinutes(),v=f>-1?+i[f]:d.getSeconds(),new Date(g,p,y,m,h,v);this.log("Empty Date Cell Text!",e)}else this.log("Date node not found!",e);var t,n,r,o,i,l,u,s,a,c,f,d,g,p,y,m,h,v;return null},e.prototype.getFilesList=function(){var e=this;return Array.from(a(document,s).querySelectorAll("table")).map((function(t){var n=t.querySelectorAll("td"),r=n[5],o=n[9],i=r?r.querySelector("a"):null;return{url:i?i.href:null,sendDate:o?e.getDateFromElement(o.firstChild):new Date}})).filter((function(e){return!!e.url})).sort((function(e,t){return e.sendDate.getTime()-t.sendDate.getTime()}))},e.prototype.downloadFile=function(e){this.log("file download >>",e),e.url&&window.open(e.url,"_blank")},e}();!function(e){e.parser=new c,e.getElementByIdPattern=a}(window)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhcnNlci50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlNUQVJUX0JVVFRPTl9DT05UQUlORVJfSURfUEFUVEVSTiIsIk1FU1NBR0VfVFlQRV9GSUVMRF9JRF9QQVRURVJOIiwiSU5TVVJFUlNfTElTVF9JRF9QQVRURVJOIiwiSU5TVVJFUlNfTElTVF9UT0dHTEVfSURfUEFUVEVSTiIsIkZJTFRFUlNfUEFORUxfSURfUEFUVEVSTiIsIlBBUkNFTFNfTElTVF9JRF9QQVRURVJOIiwiZ2V0RWxlbWVudEJ5SWRQYXR0ZXJuIiwicGFyZW50IiwiaWRQYXR0ZXJuIiwidGFnTmFtZSIsImVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsIkFycmF5IiwiZnJvbSIsImZpbmQiLCJlbGVtZW50IiwidGVzdCIsImlkIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiYnV0dG9uQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJhZGRTdGFydEJ1dHRvbiIsImNsaWNrIiwic2V0VGltZW91dCIsImNsZWFySW50ZXJ2YWwiLCJ0aGlzIiwibG9nIiwiY29uc29sZSIsImFyZ3MiLCJjb250YWluZXIiLCJidXR0b24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwic3R5bGUiLCJtYXJnaW5MZWZ0IiwiY3Vyc29yIiwib25jbGljayIsInN0YXJ0UGFyc2VyIiwiYXBwZW5kIiwibWVzc2FnZVR5cGVzIiwiZ2V0TWVzc2FnZVR5cGVzIiwiaW5zdXJlcnMiLCJnZXRJbnN1cmVycyIsImluY3JlbWVudCIsImZvckVhY2giLCJtZXNzYWdlVHlwZSIsIm1lc3NhZ2VUeXBlSW5kZXgiLCJpbnN1cmVyIiwiaW5zdXJlckluZGV4Iiwic2V0TWVzc2FnZVR5cGUiLCJzZXRJbnN1cmVyIiwiZ2V0RmlsdGVyU3VibWl0QnV0dG9uIiwiZmlsZXNMaXN0IiwiZ2V0RmlsZXNMaXN0IiwibGVuZ3RoIiwiZG93bmxvYWRGaWxlIiwicG9wIiwiaXNMYXN0TWVzc2FnZVR5cGUiLCJpc0xhc3RJbnN1cmVyIiwiYWxlcnQiLCJnZXRJbnN1cmVyc1N1Z2dlc3Rpb25zIiwiY2hpbGROb2RlcyIsIm1hcCIsInRleHRDb250ZW50IiwiYnV0dG9ucyIsImdldERhdGVGcm9tRWxlbWVudCIsIm5vZGUiLCJ0ZXh0IiwiZm9ybWF0Iiwibm9ybWFsaXplZCIsInJlcGxhY2UiLCJmb3JtYXRJdGVtcyIsInRvTG93ZXJDYXNlIiwic3BsaXQiLCJkYXRlSXRlbXMiLCJtb250aEluZGV4IiwiaW5kZXhPZiIsImRheUluZGV4IiwieWVhckluZGV4IiwiaG91ckluZGV4IiwibWludXRlc0luZGV4Iiwic2Vjb25kc0luZGV4IiwidG9kYXkiLCJEYXRlIiwieWVhciIsImdldEZ1bGxZZWFyIiwibW9udGgiLCJnZXRNb250aCIsImRheSIsImdldERhdGUiLCJob3VyIiwiZ2V0SG91cnMiLCJtaW51dGUiLCJnZXRNaW51dGVzIiwic2Vjb25kIiwiZ2V0U2Vjb25kcyIsInRhYmxlRWxlbWVudCIsImNlbGxzIiwidXJsQ2VsbCIsImRhdGVDZWxsIiwibGluayIsInF1ZXJ5U2VsZWN0b3IiLCJ1cmwiLCJocmVmIiwic2VuZERhdGUiLCJmaXJzdENoaWxkIiwiZmlsdGVyIiwiZmlsZSIsInNvcnQi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T0UsT0FBUyxJQUFJQyxFQUNwQkgsRUFBTzNHLHNCQUF3QkEsRUFGakMsQ0FHRzJHIiwiZmlsZSI6InBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImNvbnN0IFJFUE9SVF9JTl9NR0ZPTVMgPSAn0J7RgtGH0ZHRgiDQnNCeINCyINCc0JPQpNCe0JzQoSdcbmNvbnN0IFJFUE9SVF9JTl9TTU8gPSAn0J7RgtGH0ZHRgiDQnNCeINCyINCh0JzQnidcblxuY29uc3QgU1RBUlRfQlVUVE9OX0lEID0gJ3BhcnNlci1zdGFydC1idXR0b24nXG5cbmNvbnN0IERBVEVfRk9STUFUID0gJ2RkLm1tLnl5eXkgaGg6aWknXG5cbmNvbnN0IFNUQVJUX0JVVFRPTl9DT05UQUlORVJfSURfUEFUVEVSTiA9IC9eZmlsdGVyLXBhbmVsLVxcZHs0LH1faGVhZGVyLXRpdGxlLXRleHRFbCQvXG5jb25zdCBNRVNTQUdFX1RZUEVfRklFTERfSURfUEFUVEVSTiA9IC9ebWVzc2FnZVR5cGVDb21iby1cXGR7NCx9LWlucHV0RWwkL1xuY29uc3QgSU5TVVJFUl9GSUVMRF9JRF9QQVRURVJOID0gL15jb21tb25JbnN1cmVyc0NvbWJvLVxcZHs0LH0taW5wdXRFbCQvXG5jb25zdCBJTlNVUkVSU19MSVNUX0lEX1BBVFRFUk4gPSAvXmNvbW1vbkluc3VyZXJzQ29tYm8tXFxkezQsfS1waWNrZXItbGlzdEVsJC9cbmNvbnN0IElOU1VSRVJTX0xJU1RfVE9HR0xFX0lEX1BBVFRFUk4gPSAvXmNvbW1vbkluc3VyZXJzQ29tYm8tXFxkezQsfS10cmlnZ2VyLXBpY2tlciQvXG5jb25zdCBGSUxURVJTX1BBTkVMX0lEX1BBVFRFUk4gPSAvXmZpbHRlci1wYW5lbC1cXGR7NCx9JC9cbmNvbnN0IFBBUkNFTFNfTElTVF9JRF9QQVRURVJOID0gL15wYXJjZWxzTGlzdC1cXGR7NCx9LWJvZHkkL1xuXG5jb25zdCBGSUxFX0xJTktfQ0VMTF9JTkRFWCA9IDVcbmNvbnN0IEZJTEVfU0VORF9EQVRFX0NFTExfSU5ERVggPSA5XG5cbmNvbnN0IEZJTFRFUlNfQ0hBTkdFX0lOVEVSVkFMID0gMjAwMFxuY29uc3QgUEFSQ0VMU19MT0FEX1RJTUUgPSA1MDAwXG5cbmludGVyZmFjZSBJRmlsZURhdGEge1xuICBzZW5kRGF0ZTogRGF0ZSxcbiAgdXJsOiBzdHJpbmdcbn1cblxuY29uc3QgZ2V0RWxlbWVudEJ5SWRQYXR0ZXJuID0gKHBhcmVudDogSFRNTEVsZW1lbnQgfCBEb2N1bWVudCwgaWRQYXR0ZXJuOiBSZWdFeHAsIHRhZ05hbWU6IHN0cmluZyA9ICdkaXYnKTogRWxlbWVudCA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGFnTmFtZSlcbiAgcmV0dXJuIEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmQoKGVsZW1lbnQ6IEVsZW1lbnQpOiBib29sZWFuID0+IGlkUGF0dGVybi50ZXN0KGVsZW1lbnQuaWQpKVxufVxuXG5jb25zdCBzdHJpbmdUb0RhdGVCeUZvcm1hdCA9ICh0ZXh0OiBzdHJpbmcsIGZvcm1hdDogc3RyaW5nKTogRGF0ZSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQgICAgICA9IHRleHQucmVwbGFjZSgvW15hLXpBLVowLTldL2csICctJylcbiAgY29uc3Qgbm9ybWFsaXplZEZvcm1hdCA9IGZvcm1hdC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCAnLScpXG4gIGNvbnN0IGZvcm1hdEl0ZW1zICAgICA9IG5vcm1hbGl6ZWRGb3JtYXQuc3BsaXQoJy0nKVxuICBjb25zdCBkYXRlSXRlbXMgICAgICAgPSBub3JtYWxpemVkLnNwbGl0KCctJylcblxuICBjb25zdCBtb250aEluZGV4ICA9IGZvcm1hdEl0ZW1zLmluZGV4T2YoJ21tJylcbiAgY29uc3QgZGF5SW5kZXggICAgPSBmb3JtYXRJdGVtcy5pbmRleE9mKCdkZCcpXG4gIGNvbnN0IHllYXJJbmRleCAgID0gZm9ybWF0SXRlbXMuaW5kZXhPZigneXl5eScpXG4gIGNvbnN0IGhvdXJJbmRleCAgICAgPSBmb3JtYXRJdGVtcy5pbmRleE9mKCdoaCcpXG4gIGNvbnN0IG1pbnV0ZXNJbmRleCAgPSBmb3JtYXRJdGVtcy5pbmRleE9mKCdpaScpXG4gIGNvbnN0IHNlY29uZHNJbmRleCAgPSBmb3JtYXRJdGVtcy5pbmRleE9mKCdzcycpXG5cbiAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG5cbiAgY29uc3QgeWVhciA9IHllYXJJbmRleCA+IC0xID8gK2RhdGVJdGVtc1t5ZWFySW5kZXhdIDogdG9kYXkuZ2V0RnVsbFllYXIoKVxuICBjb25zdCBtb250aCA9IG1vbnRoSW5kZXggPiAtMSA/ICtkYXRlSXRlbXNbbW9udGhJbmRleF0gOiB0b2RheS5nZXRNb250aCgpXG4gIGNvbnN0IGRheSA9IGRheUluZGV4ID4gLTEgPyArZGF0ZUl0ZW1zW2RheUluZGV4XSA6IHRvZGF5LmdldERhdGUoKVxuXG4gIGNvbnN0IGhvdXIgPSBob3VySW5kZXggPiAtMSA/ICtkYXRlSXRlbXNbaG91ckluZGV4XSA6IHRvZGF5LmdldEhvdXJzKClcbiAgY29uc3QgbWludXRlID0gbWludXRlc0luZGV4ID4gLTEgPyArZGF0ZUl0ZW1zW21pbnV0ZXNJbmRleF0gOiB0b2RheS5nZXRNaW51dGVzKClcbiAgY29uc3Qgc2Vjb25kID0gc2Vjb25kc0luZGV4ID4gLTEgPyArZGF0ZUl0ZW1zW3NlY29uZHNJbmRleF0gOiB0b2RheS5nZXRTZWNvbmRzKClcblxuICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpXG59XG5cbmNsYXNzIFBhcnNlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIFNUQVJUX0JVVFRPTl9DT05UQUlORVJfSURfUEFUVEVSTilcblxuICAgICAgaWYgKGJ1dHRvbkNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLmFkZFN0YXJ0QnV0dG9uKGJ1dHRvbkNvbnRhaW5lcilcblxuICAgICAgICBjb25zdCBpbnN1cmVyc0xpc3RUb2dnbGUgPSBnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIElOU1VSRVJTX0xJU1RfVE9HR0xFX0lEX1BBVFRFUk4pIGFzIEhUTUxFbGVtZW50XG4gICAgICAgIGluc3VyZXJzTGlzdFRvZ2dsZS5jbGljaygpXG4gICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4geyBpbnN1cmVyc0xpc3RUb2dnbGUuY2xpY2soKSB9LCA1MDApXG5cbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKVxuICAgICAgfVxuICAgIH0sIDUwMClcblxuXG4gICAgdGhpcy5sb2coJ1BhcnNlciBpbml0aWFsaXplZCEnKVxuICB9XG5cbiAgcHJpdmF0ZSBsb2coLi4uYXJnczogYW55KTogdm9pZCB7XG4gICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQYXJzZXI6ICcsIC4uLmFyZ3MpXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRTdGFydEJ1dHRvbihjb250YWluZXI6IEVsZW1lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuXG4gICAgYnV0dG9uLmlubmVySFRNTCA9ICfQl9Cw0L/Rg9GB0YLQuNGC0Ywg0YHQsdC+0YAg0LTQsNC90L3Ri9GFJ1xuICAgIGJ1dHRvbi5pZCA9IFNUQVJUX0JVVFRPTl9JRFxuICAgIGJ1dHRvbi5zdHlsZS5tYXJnaW5MZWZ0ID0gJzEwcHgnXG4gICAgYnV0dG9uLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJ1xuICAgIGJ1dHRvbi5vbmNsaWNrID0gKCk6IHZvaWQgPT4geyB0aGlzLnN0YXJ0UGFyc2VyKCkgfVxuXG4gICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pXG5cbiAgICB0aGlzLmxvZygnQWRkZWQgc3RhcnQgYnV0dG9uIHRvIGNvbnRhaW5lcjonLCBjb250YWluZXIpXG4gIH1cblxuICBwdWJsaWMgc3RhcnRQYXJzZXIoKTogdm9pZCB7XG4gICAgdGhpcy5sb2coJ1BhcnNlciBzdGFydGVkIScpXG5cbiAgICBjb25zdCBtZXNzYWdlVHlwZXMgPSB0aGlzLmdldE1lc3NhZ2VUeXBlcygpXG4gICAgY29uc3QgaW5zdXJlcnMgPSB0aGlzLmdldEluc3VyZXJzKClcblxuICAgIHRoaXMubG9nKCdMb2FkZWQgZmlsdGVyIHZhbHVlczonLCB7IG1lc3NhZ2VUeXBlcywgaW5zdXJlcnMgfSlcbiAgICB0aGlzLmxvZygnUnVubmluZyBhIHF1ZXVlJylcblxuICAgIGxldCBpbmNyZW1lbnQgPSAwXG5cbiAgICBtZXNzYWdlVHlwZXMuZm9yRWFjaCgobWVzc2FnZVR5cGU6IHN0cmluZywgbWVzc2FnZVR5cGVJbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICBpbnN1cmVycy5mb3JFYWNoKChpbnN1cmVyOiBzdHJpbmcsIGluc3VyZXJJbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xuICAgICAgICAgIHRoaXMubG9nKCdBcHBseWluZyBmaWx0ZXIgdmFsdWVzOicsIHttZXNzYWdlVHlwZSwgaW5zdXJlcn0pXG4gICAgICAgICAgdGhpcy5zZXRNZXNzYWdlVHlwZShtZXNzYWdlVHlwZSlcbiAgICAgICAgICB0aGlzLnNldEluc3VyZXIoaW5zdXJlcilcbiAgICAgICAgICB0aGlzLmdldEZpbHRlclN1Ym1pdEJ1dHRvbigpLmNsaWNrKClcblxuICAgICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2coJ0dldHRpbmcgZmlsZXMgbGlzdCcpXG5cbiAgICAgICAgICAgIGNvbnN0IGZpbGVzTGlzdCA9IHRoaXMuZ2V0RmlsZXNMaXN0KClcblxuICAgICAgICAgICAgaWYgKGZpbGVzTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5sb2coYEZvdW5kICR7ZmlsZXNMaXN0Lmxlbmd0aH0gZmlsZXNgKVxuICAgICAgICAgICAgICB0aGlzLmRvd25sb2FkRmlsZSh0aGlzLmdldEZpbGVzTGlzdCgpLnBvcCgpKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5sb2coYE5vIGZpbGVzIGZvciBzZWxlY3RlZCBmaWx0ZXJzYClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaXNMYXN0TWVzc2FnZVR5cGUgPSBtZXNzYWdlVHlwZUluZGV4ID09PSBtZXNzYWdlVHlwZXMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgY29uc3QgaXNMYXN0SW5zdXJlciA9IGluc3VyZXJJbmRleCA9PT0gaW5zdXJlcnMubGVuZ3RoIC0gMVxuXG4gICAgICAgICAgICBpZiAoaXNMYXN0TWVzc2FnZVR5cGUgJiYgaXNMYXN0SW5zdXJlcikge1xuICAgICAgICAgICAgICBhbGVydCgn0JfQsNCz0YDRg9C30LrQsCDRhNCw0LnQu9C+0LIg0LfQsNCy0LXRgNGI0LXQvdCwIScpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgUEFSQ0VMU19MT0FEX1RJTUUpXG4gICAgICAgIH0sIGluY3JlbWVudCAqIChQQVJDRUxTX0xPQURfVElNRSArIEZJTFRFUlNfQ0hBTkdFX0lOVEVSVkFMKSlcblxuICAgICAgICBpbmNyZW1lbnQrK1xuICAgICAgfSlcbiAgICB9KVxuXG4gIH1cblxuICBwdWJsaWMgZ2V0TWVzc2FnZVR5cGVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW1xuICAgICAgUkVQT1JUX0lOX01HRk9NUyxcbiAgICAgIFJFUE9SVF9JTl9TTU9cbiAgICBdXG4gIH1cblxuICBwdWJsaWMgc2V0TWVzc2FnZVR5cGUobWVzc2FnZVR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGlucHV0ID0gZ2V0RWxlbWVudEJ5SWRQYXR0ZXJuKGRvY3VtZW50LCBNRVNTQUdFX1RZUEVfRklFTERfSURfUEFUVEVSTiwgJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudFxuICAgIGlucHV0LnZhbHVlID0gbWVzc2FnZVR5cGVcbiAgICB0aGlzLmxvZygnU2V0IG1lc3NhZ2UgdHlwZSBmaWx0ZXIgdG86JywgbWVzc2FnZVR5cGUpXG4gIH1cblxuICBwcml2YXRlIGdldEluc3VyZXJzU3VnZ2VzdGlvbnMoKTogQ2hpbGROb2RlW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGdldEVsZW1lbnRCeUlkUGF0dGVybihkb2N1bWVudCwgSU5TVVJFUlNfTElTVF9JRF9QQVRURVJOLCAndWwnKS5jaGlsZE5vZGVzKVxuICB9XG5cbiAgcHVibGljIGdldEluc3VyZXJzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRJbnN1cmVyc1N1Z2dlc3Rpb25zKClcbiAgICAgIC5tYXAoKGVsZW1lbnQ6IEVsZW1lbnQpOiBzdHJpbmcgPT4gZWxlbWVudC50ZXh0Q29udGVudClcbiAgfVxuXG4gIHB1YmxpYyBzZXRJbnN1cmVyKGluc3VyZXI6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gdGhpcy5nZXRJbnN1cmVyc1N1Z2dlc3Rpb25zKClcbiAgICBjb25zdCBtYXRjaGluZ1N1Z2dlc3Rpb24gPSBzdWdnZXN0aW9ucy5maW5kKChlbGVtZW50OiBFbGVtZW50KTogYm9vbGVhbiA9PiBlbGVtZW50LnRleHRDb250ZW50ID09PSBpbnN1cmVyKSBhcyBIVE1MRWxlbWVudFxuXG4gICAgbWF0Y2hpbmdTdWdnZXN0aW9uLmNsaWNrKClcbiAgICB0aGlzLmxvZygnU2V0IGluc3VyZXIgZmlsdGVyIHRvOicsIGluc3VyZXIpXG4gIH1cblxuICBwdWJsaWMgZ2V0RmlsdGVyU3VibWl0QnV0dG9uKCk6IEhUTUxFbGVtZW50IHwgbnVsbCB7XG4gICAgY29uc3QgZmlsdGVyc1BhbmVsID0gZ2V0RWxlbWVudEJ5SWRQYXR0ZXJuKGRvY3VtZW50LCBGSUxURVJTX1BBTkVMX0lEX1BBVFRFUk4pIGFzIEhUTUxFbGVtZW50XG4gICAgY29uc3QgYnV0dG9ucyA9IGZpbHRlcnNQYW5lbC5xdWVyeVNlbGVjdG9yQWxsKCdhLngtYnRuJylcblxuICAgIGlmIChidXR0b25zLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGJ1dHRvbnNbMF0gYXMgSFRNTEVsZW1lbnRcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldERhdGVGcm9tRWxlbWVudChub2RlOiBOb2RlKTogRGF0ZSB7XG4gICAgaWYgKG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnRleHRDb250ZW50KSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdUb0RhdGVCeUZvcm1hdChub2RlLnRleHRDb250ZW50LCBEQVRFX0ZPUk1BVClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9nKCdFbXB0eSBEYXRlIENlbGwgVGV4dCEnLCBub2RlKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZygnRGF0ZSBub2RlIG5vdCBmb3VuZCEnLCBub2RlKVxuICAgIH1cblxuICAgIHJldHVybiBudWxsXG4gIH1cblxuICBwdWJsaWMgZ2V0RmlsZXNMaXN0KCk6IGFueVtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShnZXRFbGVtZW50QnlJZFBhdHRlcm4oZG9jdW1lbnQsIFBBUkNFTFNfTElTVF9JRF9QQVRURVJOKS5xdWVyeVNlbGVjdG9yQWxsKCd0YWJsZScpKVxuICAgICAgLm1hcCgodGFibGVFbGVtZW50OiBIVE1MRWxlbWVudCk6IElGaWxlRGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGxzID0gdGFibGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJylcbiAgICAgICAgY29uc3QgdXJsQ2VsbCA9IGNlbGxzW0ZJTEVfTElOS19DRUxMX0lOREVYXVxuICAgICAgICBjb25zdCBkYXRlQ2VsbCA9IGNlbGxzW0ZJTEVfU0VORF9EQVRFX0NFTExfSU5ERVhdXG4gICAgICAgIGNvbnN0IGxpbmsgPSB1cmxDZWxsID8gdXJsQ2VsbC5xdWVyeVNlbGVjdG9yKCdhJykgOiBudWxsXG5cbiAgICAgICAgY29uc3QgdXJsID0gbGluayA/IGxpbmsuaHJlZiA6IG51bGxcbiAgICAgICAgY29uc3Qgc2VuZERhdGUgPSBkYXRlQ2VsbCA/IHRoaXMuZ2V0RGF0ZUZyb21FbGVtZW50KGRhdGVDZWxsLmZpcnN0Q2hpbGQpIDogbmV3IERhdGUoKVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIHNlbmREYXRlXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKChmaWxlOiBJRmlsZURhdGEpOiBib29sZWFuID0+ICEhZmlsZS51cmwpXG4gICAgICAuc29ydCgoYTogSUZpbGVEYXRhLCBiOiBJRmlsZURhdGEpOiBudW1iZXIgPT4gYS5zZW5kRGF0ZS5nZXRUaW1lKCkgLSBiLnNlbmREYXRlLmdldFRpbWUoKSlcbiAgfVxuXG4gIHByaXZhdGUgZG93bmxvYWRGaWxlKGZpbGU6IElGaWxlRGF0YSk6IHZvaWQge1xuICAgIHRoaXMubG9nKCdmaWxlIGRvd25sb2FkID4+JywgZmlsZSlcbiAgICBpZiAoZmlsZS51cmwpIHtcbiAgICAgIHdpbmRvdy5vcGVuKGZpbGUudXJsLCAnX2JsYW5rJylcbiAgICB9XG4gIH1cbn1cblxuKCh3aW5kb3c6IGFueSk6IHZvaWQgPT4ge1xuICB3aW5kb3cucGFyc2VyID0gbmV3IFBhcnNlcigpXG4gIHdpbmRvdy5nZXRFbGVtZW50QnlJZFBhdHRlcm4gPSBnZXRFbGVtZW50QnlJZFBhdHRlcm5cbn0pKHdpbmRvdylcbiJdLCJzb3VyY2VSb290IjoiIn0=